---
import "@fontsource/azeret-mono";
import "@fontsource/bebas-neue";
import "@fontsource/roboto";

import "../styles/base.css";

import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import BaseHead from "./BaseHead.astro";

import Cmd from "../components/Cmd.astro";
import ScrollTop from "../components/ScrollTop";
import ThemeToggle from "../components/ThemeToggle";

const { title, description, image } = Astro.props;
const { pathname } = Astro.url;
const isBlogPost = pathname !== "/blog" && pathname !== "/blog/" && pathname.startsWith("/blog/");

let cmdText;
if (title === "404") {
  cmdText = `cd ${pathname}`;
} else if (pathname === "/") {
  cmdText = `whoami -h`;
} else if (pathname.startsWith("/blog") && !isBlogPost) {
  cmdText = `blog --index`;
} else if (pathname.startsWith("/contact")) {
  cmdText = `contact --me`;
}
---

<!DOCTYPE html>
<html lang="en">
  <BaseHead title={title} description={description} image={image} />
  <body class="bg-gruvbox-bgH text-gruvbox-fg2 dark:bg-gruvboxDark-bgXH dark:text-gruvboxDark-fg3">
    {/* cursor trail */}
    <div
      id="trail_main"
      class="trail_hidden pointer-events-none fixed left-0 top-0 z-10 h-2 w-2 rounded-full bg-gruvbox-fg opacity-0 transition-all duration-300 dark:bg-gruvboxDark-fg"
    >
    </div>
    <div
      id="trail_outline"
      class="trail_hidden pointer-events-none fixed left-0 top-0 z-10 h-7 w-7 rounded-full border-2 border-gruvbox-fg opacity-0 transition-all duration-300 dark:border-gruvboxDark-fg"
    >
    </div>
    <div class="mx-2 md:mx-16 lg:mx-36 xl:mx-52 2xl:mx-72">
      <Header />

      <ScrollTop client:idle />

      {/* Title bar */}
      <div
        class="sticky top-0 z-50 flex h-6 items-center justify-between rounded-t border border-b-0 border-gruvbox-bg1 bg-gruvbox-bg px-3 pt-1 dark:border-gruvboxDark-bg dark:bg-gruvboxDark-bgH"
      >
        <div class="font-azeret text-xs">
          {isBlogPost ? "Blog" : title || "Home"}
        </div>
        <div class="flex gap-2">
          <div class="h-1.5 w-1.5 rounded-sm bg-gruvbox-yellow dark:bg-gruvboxDark-yellow2"></div>
          <div class="h-1.5 w-1.5 rounded-sm bg-gruvbox-green dark:bg-gruvboxDark-green2"></div>
          <div class="h-1.5 w-1.5 rounded-sm bg-gruvbox-red dark:bg-gruvboxDark-red2"></div>
        </div>
      </div>

      {/* window content */}
      <div
        class="relative z-50 overflow-y-auto border border-t-0 border-gruvbox-bg1 bg-gruvbox-bg p-4 shadow-xl dark:border-gruvboxDark-bg dark:bg-gruvboxDark-bgH"
      >
        <div class="absolute right-0 top-0 overflow-hidden">
          <ThemeToggle client:only="solid-js" />
        </div>
        {cmdText && <Cmd text={cmdText} />}

        <main class="min-h-[calc(100vh-18rem)]">
          <slot />
        </main>
        <Footer />
      </div>
    </div>

    <script>
      const trail = document.getElementById("trail_main");
      const trailOutline = document.getElementById("trail_outline");

      let highlighted = false;
      let hasMoved = false;

      window.addEventListener("mousemove", (e) => {
        let duration1 = 350;
        let duration2 = highlighted ? 300 : 750;

        if (!hasMoved) {
          hasMoved = true;
          trailOutline.classList.remove("trail_hidden");
          trail.classList.remove("trail_hidden");
          duration1 = 0;
          duration2 = 0;
        }

        const x = e.clientX - trail.offsetWidth / 2,
          y = e.clientY - trail.offsetHeight / 2;

        const x2 = e.clientX - trailOutline.offsetWidth / 2,
          y2 = e.clientY - trailOutline.offsetHeight / 2;

        const keyframes = {
          transform: `translate(${x}px, ${y}px)`
        };
        const keyframes2 = {
          transform: `translate(${x2}px, ${y2}px)`
        };

        trail.animate(keyframes, {
          duration: duration1,
          fill: "forwards"
        });

        trailOutline.animate(keyframes2, {
          duration: duration2,
          fill: "forwards"
        });
      });
      document.addEventListener("mouseover", (e) => {
        if (
          (e.target as HTMLElement).classList.contains("__highlight") ||
          (e.target as HTMLElement).parentElement?.classList.contains("__highlight")
        ) {
          if (!highlighted) highlighted = true;
          if (!trail.classList.contains("trail_hidden")) {
            trail.classList.add("trail_hidden");
          }
          if (!trailOutline.classList.contains("trail_highlight")) {
            trailOutline.classList.add("trail_highlight");
          }
        } else {
          if (highlighted) highlighted = false;
          if (hasMoved && trail.classList.contains("trail_hidden")) {
            trail.classList.remove("trail_hidden");
          }
          if (trailOutline.classList.contains("trail_highlight")) {
            trailOutline.classList.remove("trail_highlight");
          }
        }
      });
    </script>
  </body>
</html>
